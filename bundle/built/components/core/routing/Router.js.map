{"version":3,"sources":["components/core/routing/Router.ts"],"names":["Router","Router.constructor","Router.execute","Router.render","Router.setViewParams","Router.setContext","Router.log"],"mappings":"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","file":"components/core/routing/Router.js","sourcesContent":["/**\n * Alliance : TypeScript framework for NodeJS (http://alliancejs.com)\n * Copyright (c) Eugene Pisotsky (http://alliancejs.com)\n *\n * Licensed under The MIT License\n * For full copyright and license information, please see the LICENSE.txt\n * Redistributions of files must retain the above copyright notice.\n *\n * @copyright     Copyright (c) Eugene Pisotsky (http://alliancejs.com)\n * @link          http://alliancejs.com Alliance Project\n * @license       http://www.opensource.org/licenses/mit-license.php MIT License\n */\n\nimport * as express  from 'express';\nimport * as path from 'path';\nimport { controllerBuilder, server } from '../../Bundle';\nimport { RouteType } from '../../../decorators/core/Route';\nimport { Log } from '../debug/Log';\nimport {\n    DecoratedController,\n    ActionDefinition\n} from '../interfaces/core';\n\nexport class Router {\n\n    actionResult: Promise<any>;\n    actionResultValue: any;\n    context: Object;\n    viewPath: string;\n\n    constructor(public controller: any,\n                public key: any,\n                public req: express.Request,\n                public res: express.Response,\n                public next: any) {\n\n        controller.request = req;\n        controller.response = res;\n\n        this.controller.app = server.express;\n    }\n\n    /**\n     * Execute action method and call express next\n     */\n    public execute(): void {\n        if (this.actionResult instanceof Promise) {\n            this.actionResult.then(result => {\n                this.actionResultValue = result;\n                this.next();\n            });\n        } else {\n            this.actionResultValue = this.actionResult;\n            this.next();\n        }\n    }\n\n    /**\n     * Render view if action isn`t restful\n     */\n    public render(req: express.Request, res: express.Response): void {\n        this.log(req, res);\n\n        switch (typeof this.actionResultValue) {\n            case \"object\":\n                if (!this.actionResultValue.hasOwnProperty('statusCode')) {\n                    res.end(JSON.stringify(this.actionResultValue));\n                }\n            break;\n            case \"number\":\n            case \"string\":\n                res.end(this.actionResultValue);\n            break;\n            default:\n                this.setContext();\n                this.setViewParams();\n\n                this.res.render(this.viewPath, this.context);\n            break;\n        }\n\n    }\n\n    /**\n     * Set view params e.g. layout, template and view path\n     */\n    private setViewParams(): void {\n        /*if (this.controller.options.hasOwnProperty('layout') &&\n            !this.controller.hasOwnProperty('layout')) {\n            this.controller['layout'] = this.controller.options.layout;\n        }*/\n\n        if (!this.controller.template) {\n            this.controller.template = this.key.toLowerCase();\n        }\n\n        this.viewPath = path.join(\n            this.controller.constructor.name.slice(0, -10).toLowerCase(),\n            this.controller.template\n        );\n    }\n\n    /**\n     * Set context for handlebars\n     */\n    private setContext(): void {\n        this.context = this.controller;\n\n        for (const key in this.controller.renderVariables) {\n            this.context[key] = this.controller.renderVariables[key];\n        }\n    }\n\n    /**\n     * Log request after response\n     */\n    private log(req, res): void {\n        let status = res.statusCode.toString();\n\n        if (res.statusCode >= 200 && res.statusCode < 300) {\n            status = status.green;\n        }\n        else if (res.statusCode >= 300 && res.statusCode < 500) {\n            status = status.yellow;\n        }\n        else if (res.statusCode >= 500) {\n            status = status.red;\n        }\n\n        Log.message(req.method.cyan.bold, status, req.path);\n    }\n\n}\n"],"sourceRoot":"/source/"}